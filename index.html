<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyecto 2 - Machine Learning</title>
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript" src="tytus.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
    <div class="container">
        <h2>Proyecto 2 - Machine Learning - Inteligencia Artificial 1</h2>
        <p id="log"></p>

        <label for="modelSelect">Seleccione el modelo:</label>
        <select id="modelSelect">
            <option value="seleccionar">Seleccionar</option>
            <option value="regresionLineal">Regresión Lineal</option>
            <option value="regresionLogistica">Regresión Logistica</option>
            <option value="regresionPolinomial">Regresión Polinomial</option>
            <option value="NaiveBayes">Naive Bayes</option>
            <option value="redesNeuronales">Redes Neuronales</option>
            <option value="kmeans">K-means</option>
            <option value="kneighbor">K-nearest Neighbor</option>
        </select>
        
        <input type="file" id="fileInput" accept=".csv" />
        
        <button onclick="trainModel()">Entrenamiento</button>
        <button onclick="predictModel()">Predicción</button>
        <button onclick="showGraph()">Mostrar Gráficas</button>
        <button onclick="showTrend()">Tendencia</button>
        <button onclick="showPatterns()">Patrones</button>

        <div id="chart_div"></div>
    </div>

    <script type="text/javascript">
        let xTrain = [];
        let yTrain = [];
        let yPredict = [];
        let linear;
        let polynomial;
        const gradoPolinomial = 3;
    
        function loadCSV() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Por favor, selecciona un archivo CSV.');
                return;
            }
    
            const reader = new FileReader();
            reader.onload = function(event) {
                const csvData = event.target.result;
                processCSV(csvData);
            };
            reader.readAsText(file);
        }
    
        function processCSV(data) {
            const lines = data.split('\n');
            xTrain = [];
            yTrain = [];
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].split(',');
                if (line.length === 2) { 
                    xTrain.push(parseFloat(line[0]));
                    yTrain.push(parseFloat(line[1]));
                }
            }
            document.getElementById("log").innerHTML += '<br>Datos cargados exitosamente.';
        }
    
        function trainModel() {
            document.getElementById("log").innerHTML = "";
            const model = document.getElementById('modelSelect').value;
    
            if (model === 'regresionLineal') {
                loadCSV();
                linear = new LinearRegression();
                linear.fit(xTrain, yTrain);
                document.getElementById("log").innerHTML += '<br>Modelo de Regresión Lineal entrenado.<br>X Train: ' + xTrain + '<br>Y Train: ' + yTrain;
            } else if (model === 'regresionPolinomial') {
                loadCSV();
                trainPolynomialRegression();
            } else {
                alert('Por favor, selecciona un modelo válido para entrenar.');
            }
        }
    
        function trainPolynomialRegression() {
            // Lógica para entrenar el modelo de regresión polinomial
            polynomial = new PolynomialRegression(gradoPolinomial);
            polynomial.fit(xTrain, yTrain);
            document.getElementById("log").innerHTML += '<br>Modelo de Regresión Polinomial entrenado con grado ' + gradoPolinomial + '.';
        }
    
        function predictModel() {
            const model = document.getElementById('modelSelect').value;
    
            if (model === 'regresionLineal' && linear) {
                yPredict = linear.predict(xTrain);
                document.getElementById("log").innerHTML += '<br>Predicción realizada.<br>Y Predict: ' + yPredict;
            } else if (model === 'regresionPolinomial' && polynomial) {
                predictPolynomialRegression();
            } else {
                alert('Primero entrena el modelo antes de predecir.');
            }
        }
    
        function predictPolynomialRegression() {
            // Lógica para realizar la predicción con el modelo de regresión polinomial
            yPredict = polynomial.predict(xTrain);
            document.getElementById("log").innerHTML += '<br>Predicción realizada para la Regresión Polinomial.<br>Y Predict: ' + yPredict;
        }

        function showGraph() {
            if (yPredict.length > 0) {
                const dataArray = joinArrays('x', xTrain, 'yTrain', yTrain, 'yPredict', yPredict);

                google.charts.load('current', {'packages': ['corechart']});
                google.charts.setOnLoadCallback(() => drawChart(dataArray));
            } else {
                alert('Primero realiza una predicción para mostrar la gráfica.');
            }
        }

        function showTrend() {
            if (xTrain.length > 1 && yTrain.length > 1) {
                const trendData = [];
                for (let i = 0; i < xTrain.length; i++) {
                    trendData.push([xTrain[i], yTrain[i]]);
                }
                
                // Calcular dirección de tendencia
                const slope = (yTrain[yTrain.length - 1] - yTrain[0]) / (xTrain[xTrain.length - 1] - xTrain[0]);
                const trendText = slope > 0 ? "La tendencia es ascendente." : "La tendencia es descendente.";

                document.getElementById("log").innerHTML += `<br>${trendText}`;
                
                google.charts.load('current', {'packages': ['corechart']});
                google.charts.setOnLoadCallback(() => drawTrendChart(trendData));
            } else {
                alert('Primero carga y entrena un modelo con datos suficientes.');
            }
        }

        function showPatterns() {
            if (xTrain.length > 1 && yTrain.length > 1) {
                const avgData = xTrain.map((x, index) => [x, yTrain[index]]);
                
                // Análisis de patrones: detectar picos y valles
                let peaks = 0, valleys = 0;
                for (let i = 1; i < yTrain.length - 1; i++) {
                    if (yTrain[i] > yTrain[i - 1] && yTrain[i] > yTrain[i + 1]) peaks++;
                    if (yTrain[i] < yTrain[i - 1] && yTrain[i] < yTrain[i + 1]) valleys++;
                }

                const patternText = `Patrones detectados: ${peaks} picos y ${valleys} valles en los datos.`;
                document.getElementById("log").innerHTML += `<br>${patternText}`;
                
                google.charts.load('current', {'packages': ['corechart']});
                google.charts.setOnLoadCallback(() => drawPatternChart(avgData));
            } else {
                alert('Primero carga y entrena un modelo con datos suficientes.');
            }
        }

        function drawChart(dataArray) {
            var data = google.visualization.arrayToDataTable(dataArray);
            var options = {
                seriesType: 'scatter',
                series: {1: {type: 'line'}}
            };
            var chart = new google.visualization.ComboChart(document.getElementById('chart_div'));
            chart.draw(data, options);
        }

        function drawTrendChart(dataArray) {
            const data = google.visualization.arrayToDataTable([['X', 'Y'], ...dataArray]);
            const options = {
                title: 'Tendencia de los datos',
                trendlines: { 0: {} },
                legend: { position: 'bottom' }
            };
            const chart = new google.visualization.LineChart(document.getElementById('chart_div'));
            chart.draw(data, options);
        }

        function drawPatternChart(dataArray) {
            const data = google.visualization.arrayToDataTable([['X', 'Y'], ...dataArray]);
            const options = {
                title: 'Patrones en los datos',
                hAxis: { title: 'X' },
                vAxis: { title: 'Y' },
                legend: 'none'
            };
            const chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
            chart.draw(data, options);
        }
    </script>
</body>
</html>


